---
title: "Clustering"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 
# CLUSTERING
```{r}
columns <- c(sapply(train2, is.numeric))
train3 <- train2[, columns]
train3[is.na(columns),]
```


```{r}
## Normalizacion
train3<-scale(train3)
train3[is.na(columns),]
```

```{r}
non_na_rows <- complete.cases(train3)
# Filter the training data based on non-NA rows
train3 <- train3[non_na_rows, ]
train3[is.na(columns),]
```


```{r}
##¿Hacemos agrupamiento?
set.seed(123)
hopkins(train3)
train3_dist<- dist(train3)
train3[is.na(columns),]
```


```{r}
fviz_dist(train3_dist, show_labels = F)
```


```{r}
fviz_nbclust(train3, kmeans, method = "wss") +
  labs(subtitle = "Elbow method")

#Metodo de la silueta
fviz_nbclust(train3, kmeans, method = "silhouette") +
  labs(subtitle = "Silhouette method")

#Metodo de Gap
fviz_nbclust(train3, kmeans, nstart = 25, method = "gap_stat", nboot = 50, verbose = F)+
  labs(subtitle = "Gap statistic method")
```


```{r}
#Agrupamiento
## KMeans
km<-kmeans(train3,3,iter.max =1000)
plotcluster(train3,km$cluster) #grafica la ubicaciÃ³n de los clusters
```


```{r}
### Cardinalidad de los grupos
km$size
### Variabilidad intragrupo
km$withinss
```


```{r}
#Clustering Jerarquico
train3_dist <- dist(train3)
hc <- hclust(train3_dist, method = "ward.D2")
plot(hc, cex=0.5, axes=FALSE)
rect.hclust(hc, k=3)
```


```{r}
fviz_dend(hc, k=3, rect = TRUE, cex = 0.5)

groups <- cutree(hc, k=3)
train3$gruposHC <- groups
```


```{r}
#Evaluacion de la calidad por el metodo de la silueta
silhc <- silhouette(groups, train3_dist)
mean(silhc[,3])
#tamanio de los grupos
table(train3$gruposHC)
#medida de variables
by(train3, train3$gruposHC, colMeans)
```


```{r}
#Evaluacion de la calidad por el metodo de la silueta
silhc <- silhouette(groups, train3_dist)
mean(silhc[,3])
```


```{r}
# Compute silhouette
silkm <- silhouette(km$cluster, train3_dist)

# Print mean silhouette width
cat("Mean Silhouette Width:", mean(silkm[,3]), "\n")

# Plot silhouette
fviz_silhouette(silkm, palette = c("#1B9E77", "#D95F02", "blue", "red", "yellow", "pink", "purple"))
summary(silkm[,3])
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
