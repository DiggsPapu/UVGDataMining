---
title: "HDT7"
output: html_document
---

Importación de librerías
```{r}
library(e1071)
library(caret)
install.packages("tidyverse")
library(tidyverse)
```

Preprocesamiento: [Ver HDT3]
```{r}
# Utilizar los mismos conjuntos de entrenamiento y de prueba
trainHDT7<-trainHDT4
testHDT7<-testCompleto
# Making a multiple level factor
trainHDT7$Category <- as.factor(trainHDT7$Category)
testHDT7$predRF <- as.factor(testHDT7$predRF)
colnames(testHDT7)
```
# Crear los modelos
## Modelo lineal
```{r}
control <- trainControl(method = "cv",number = 10)
c <- expand.grid(cost = c(0.01, 0.1, 1, 5,16,32))
svm_model1<- train(species~.,
      data=train,
      method="svmLinear2",
      tuneGrid=c,
      trControl=control,
      metric="Accuracy"
)
svm_model1
pred_svm_model1<-predict(svm_model1,testHDT7)
confusionMatrix(testHDT7$predRF,pred_svm_model1)
```
## Modelo Polinomial
```{r}
params <- expand.grid(C = c(0.01, 0.1, 1, 5,16,32),degree=c(2,3,5,7),scale=c(0.01,0.1,1))
svm_model2<- train(Category~.,
      data=trainHDT7,
      method="svmPoly",
      tuneGrid=params,
      trControl=control,
      metric="Accuracy"
)
svm_model2
pred_svm_model2<-predict(svm_model2,testHDT7)
confusionMatrix(testHDT7$predRF,pred_svm_model2)

```
## Modelo Radial
```{r}
params <- expand.grid(C = c(0.01, 0.1, 1, 5,16,32),sigma=c(0.0000000002,0.00002,0.01,0.1,20,200))
svm_model3<- train(Category~.,data=trainHDT7,method="svmRadial",tuneGrid=params,trControl=control,metric="Accuracy")
svm_model3
pred_svm_model1<-predict(svm_model1,testHDT7)
confusionMatrix(testHDT7$predRF,pred_svm_model1)
```
# No validacion cruzada
## Crear el modelo logistico para determinar si es caro o no con todas las columnas
```{r}
modeloLogistico <- glm(
  Cara~ MSSubClass + LotFrontage + LotArea + OverallQual + OverallCond + YearBuilt + YearRemodAdd + MasVnrArea + BsmtFinSF1 + BsmtFinSF2 + BsmtUnfSF + X1stFlrSF + X2ndFlrSF + LowQualFinSF + BsmtFullBath + BsmtHalfBath + FullBath + HalfBath + BedroomAbvGr + KitchenAbvGr + TotRmsAbvGrd + Fireplaces + GarageYrBlt + GarageCars + GarageArea + WoodDeckSF + OpenPorchSF + EnclosedPorch + X3SsnPorch + ScreenPorch + PoolArea + MiscVal + MoSold + YrSold,
  data = trainHDT6Dicotomicas,
  family = binomial(),
  na.action = na.exclude
)
summary(modeloLogistico)
BIC(modeloLogistico$finalModel)
```
Se observa que MSSubClass, OverallQual, YearBuilt, YearRemodAdd, X1stFlrSF, X2ndFlrSF, BsmtFullBath, PoolArea son significativos para el modelo mientras que las demas variables no lo son.
El AIC es de 607.51. 

## Pruebas de prediccion
```{r}
pred <- predict(modeloLogistico,newdata = testHDT6Dicotomicas[,c("Id","MSSubClass"    ,"LotFrontage"   ,"LotArea", "OverallQual"  , "OverallCond"  , "YearBuilt"    , "YearRemodAdd", "MasVnrArea"   , "BsmtFinSF1"   , "BsmtFinSF2"   , "BsmtUnfSF", "X1stFlrSF"    , "X2ndFlrSF"    , "LowQualFinSF", "BsmtFullBath" , "BsmtHalfBath" , "FullBath", "HalfBath"     , "BedroomAbvGr" , "KitchenAbvGr" , "TotRmsAbvGrd", "Fireplaces"   , "GarageYrBlt"  , "GarageCars"   , "GarageArea", "WoodDeckSF"   , "OpenPorchSF"  , "EnclosedPorch", "X3SsnPorch", "ScreenPorch"  , "PoolArea"     , "MiscVal"      , "MoSold", "YrSold")])
pred <- ifelse(pred>=0.5,1,0)
head(pred)
```
# Matriz de confusion
```{r}
caret::confusionMatrix(as.factor(pred),as.factor(testHDT6Dicotomicas$Cara))
```
# Multicolinealidad
```{r}
View(round(cor(trainHDT6Dicotomicas),2))
```
No se observa ninguna multicolinealidad entre las variables.

# Validacion cruzada
## Modelo de validacion cruzada
```{r}
cv <- trainControl(method="cv", 
                          number=150)
modelo_todas_cv <- caret::train(
  Cara~MSSubClass + LotFrontage + LotArea + OverallQual + OverallCond + YearBuilt + YearRemodAdd + MasVnrArea + BsmtFinSF1 + BsmtFinSF2 + BsmtUnfSF + X1stFlrSF + X2ndFlrSF + LowQualFinSF + BsmtFullBath + BsmtHalfBath + FullBath + HalfBath + BedroomAbvGr + KitchenAbvGr + TotRmsAbvGrd + Fireplaces + GarageYrBlt + GarageCars + GarageArea + WoodDeckSF + OpenPorchSF + EnclosedPorch + X3SsnPorch + ScreenPorch + PoolArea + MiscVal + MoSold + YrSold,
  data=trainHDT6Dicotomicas,
  method="glm",
  family = binomial,
  trControl = cv)
summary(modelo_todas_cv)
BIC(modelo_todas_cv$finalModel)
```
Se observa que las variables que realmente aportan al modelo son OverallQual, YearBuilt, X1stFlrSF, X2ndFlrSF, PoolArea
El AIC es de 606.54 por lo que no mejora significativamente, así mismo el BIC es de 780.8058.
## Pruebas de prediccion
```{r}
predVC <- predict(modelo_todas_cv,newdata = testHDT6Dicotomicas[,c("Id","MSSubClass"    ,"LotFrontage"   ,"LotArea", "OverallQual"  , "OverallCond"  , "YearBuilt"    , "YearRemodAdd", "MasVnrArea"   , "BsmtFinSF1"   , "BsmtFinSF2"   , "BsmtUnfSF", "X1stFlrSF"    , "X2ndFlrSF"    , "LowQualFinSF", "BsmtFullBath" , "BsmtHalfBath" , "FullBath", "HalfBath"     , "BedroomAbvGr" , "KitchenAbvGr" , "TotRmsAbvGrd", "Fireplaces"   , "GarageYrBlt"  , "GarageCars"   , "GarageArea", "WoodDeckSF"   , "OpenPorchSF"  , "EnclosedPorch", "X3SsnPorch", "ScreenPorch"  , "PoolArea"     , "MiscVal"      , "MoSold", "YrSold")])
predVC <- ifelse(predVC>=0.5,1,0)
head(predVC)
```
# Matriz de confusion
```{r}
caret::confusionMatrix(as.factor(pred),as.factor(testHDT6Dicotomicas$Cara))
```
