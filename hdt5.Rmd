---
title: "hdt5"
output: html_document
---

Importación de librerías
```{r}
library(e1071)
library(caret)
```

Preprocesamiento: [Ver HDT3]
```{r}
train2
columns <- c(sapply(train2, is.numeric))
trainHDT4 <- train2[,columns]

trainHDT4<-trainHDT4[complete.cases(trainHDT4), ]

# Calcula la media y la desviación estándar
media <- mean(trainHDT4$SalePrice)
desvEst <- sd(trainHDT4$SalePrice)

# Número de desviaciones estándar para considerar
nDesvEst <- 1

# Filtra los datos para eliminar atípicos
trainHDT4 <- trainHDT4 %>% 
  filter(SalePrice >= (media - nDesvEst * desvEst) & SalePrice <= (media + nDesvEst * desvEst))

corte <- sample(nrow(trainHDT4),nrow(trainHDT4)*0.7)
train_copy<-trainHDT4[corte,]
test_copy<-trainHDT4[-corte,]
```
Naive Bayes
Dato a predecir: SalesPrice
Predictores: El resto de variables
```{r}
### Predecir precio de venta usando todas las variables
modelo<-naiveBayes(train_copy$SalePrice~., data=train_copy)
```
Pruebas de prediccion
```{r}
prediccion <- predict(modelo, newdata = test_copy)
prediccion <- as.integer(as.character(prediccion))
mse <- mean((prediccion - test_copy$SalePrice)^2)
rmse <- sqrt(mse)

# Calcula la media de los valores observados
media <- mean(test_copy$SalePrice)

# Calcula R^2 manualmente
R2 <- 1 - sum((test_copy$SalePrice - prediccion)^2) / sum((test_copy$SalePrice - media)^2)

#MSE
mse
#RMSE
rmse
#R^2
R2
```
Variable de respuesta
```{r}
trainHDT4$Category <- ifelse(trainHDT4$SalePrice <= 137500, "Economica",
                           ifelse(trainHDT4$SalePrice <= 196875, "Intermedia", "Cara"))
trainHDT4 <- trainHDT4[, -which(names(trainHDT4) == "SalePrice")]

corte <- sample(nrow(trainHDT4),nrow(trainHDT4)*0.7)
train_copy<-trainHDT4[corte,]
test_copy<-trainHDT4[-corte,]
```
Modelo de clasificacion
```{r}
### Predecir precio de venta usando todas las variables
modelo<-naiveBayes(train_copy$Category~., data=train_copy)
```
Pruebas de prediccion
```{r}
prediccion <- predict(modelo, newdata = test_copy)
```
Matriz de confusion
```{r}
cfm<-confusionMatrix(as.factor(prediccion),as.factor(test_copy$Category))
cfm
```
Identificando sobreajuste
```{r}
prediccion <- predict(modelo, newdata = train_copy)
cfm<-confusionMatrix(as.factor(prediccion),as.factor(train_copy$Category))
cfm
```
Validación cruzada
```{r}
ct<-trainControl(method = "cv",number=10, verboseIter=T)
modeloCaret<-train(Category~.,data=train_copy,method="nb",trControl = ct)
prediccionCaret<-predict(modeloCaret,newdata = test_copy)
```
Matriz de confusion CV
```{r}
cfm<-confusionMatrix(as.factor(prediccionCaret),as.factor(test_copy$Category))
cfm
```
Tuneo modelo de clasificacion
```{r}
tune_grid <- expand.grid(
  usekernel = c(TRUE, FALSE),
  fL = seq(0, 1, length = 10), # Explora valores entre 0 y 1
  adjust = 1 # Puedes variar esto si 'usekernel' es TRUE
)

ct<-trainControl(method = "cv",number=10, verboseIter=T)
modeloCaret<-train(Category~.,data=train_copy,method="nb",trControl = ct,tuneGrid=tune_grid)
prediccionCaret<-predict(modeloCaret,newdata = test_copy)
```
Matriz de confusion CV
```{r}
cfm<-confusionMatrix(as.factor(prediccionCaret),as.factor(test_copy$Category))
cfm
```